[platformio]
default_envs = esp32dev

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; Serial monitor speed (must match Serial.begin(115200))
monitor_speed = 115200

; Libraries
lib_deps =
    adafruit/RTClib @ ^2.1.3
    arduino-libraries/NTPClient @ ^3.2.1
    blynkkk/Blynk @ ^1.3.2

; Build flags — Blynk IoT enabled
; All credentials centralized here (not hardcoded in source)
build_flags =
    -D USE_BLYNK
    -D BLYNK_TEMPLATE_ID='"TMPL2pEAxEmoM"'
    -D BLYNK_TEMPLATE_NAME='"AquariumController"'
    -D BLYNK_AUTH_TOKEN='"SDXiJ9ngMKQVgteVm83DS1UCgmggjkXZ"'
    -D WIFI_SSID='"TIM ULTRAFIBRA_1C88_2G"'
    -D WIFI_PASSWORD='"MYjx!43GRw"'

; ==============================================================================
; Native test environment — runs on host machine (no ESP32 required)
; ==============================================================================
[env:native]
platform = native
build_flags =
    -std=c++17
    -I test/mocks
    -I include
test_build_src = yes
lib_extra_dirs = test
lib_deps =
lib_ignore =
    RTClib
    NTPClient
    WiFi
    Wire
    Preferences
build_src_filter =
    +<*>
    -<main.cpp>
    -<BlynkManager.cpp>
    -<RainMakerManager.cpp>
    -<TimeManager.cpp>
test_framework = unity

; ==============================================================================
; Coverage environment — generates gcov/lcov coverage report
; Run: pio test -e coverage && ./scripts/coverage.sh
; ==============================================================================
[env:coverage]
platform = native
build_flags =
    -std=c++17
    -I test/mocks
    -I include
    --coverage
    -O0
    -g
extra_scripts = pre:scripts/add_coverage_link.py
test_build_src = yes
lib_extra_dirs = test
lib_deps =
lib_ignore =
    RTClib
    NTPClient
    WiFi
    Wire
    Preferences
build_src_filter =
    +<*>
    -<main.cpp>
    -<BlynkManager.cpp>
    -<RainMakerManager.cpp>
    -<TimeManager.cpp>
test_framework = unity
