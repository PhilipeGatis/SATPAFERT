[platformio]
default_envs = esp32dev

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
board_build.filesystem = littlefs

; Serial monitor speed (must match Serial.begin(115200))
monitor_speed = 115200

; Libraries
lib_deps =
    adafruit/RTClib @ ^2.1.3
    arduino-libraries/NTPClient @ ^3.2.1
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    https://github.com/me-no-dev/AsyncTCP.git
    adafruit/Adafruit SSD1306 @ ^2.5.7
    adafruit/Adafruit GFX Library @ ^1.11.5

; Build flags
build_flags =
    -D USE_WEBSERVER
    -D WIFI_SSID='"TIM ULTRAFIBRA_1C88_2G"'
    -D WIFI_PASSWORD='"MYjx\!43GRw"'
    -D AP_SSID='"AquariumController"'
    -D AP_PASSWORD='"aqua1234"'

; ==============================================================================
; Wokwi simulation — fast TPA (seconds), auto-start, small volumes
; Build: pio run -e wokwi
; ==============================================================================
[env:wokwi]
platform = espressif32
board = esp32dev
framework = arduino
board_build.filesystem = littlefs
monitor_speed = 115200
lib_deps =
    adafruit/RTClib @ ^2.1.3
    arduino-libraries/NTPClient @ ^3.2.1
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    https://github.com/me-no-dev/AsyncTCP.git
    adafruit/Adafruit SSD1306 @ ^2.5.7
    adafruit/Adafruit GFX Library @ ^1.11.5
build_flags =
    -D USE_WEBSERVER
    -D WIFI_SSID='"TIM ULTRAFIBRA_1C88_2G"'
    -D WIFI_PASSWORD='"MYjx\!43GRw"'
    -D AP_SSID='"AquariumController"'
    -D AP_PASSWORD='"aqua1234"'
    -D WOKWI_TEST

; ==============================================================================
; Native test environment — runs on host machine (no ESP32 required)
; ==============================================================================
[env:native]
platform = native
build_flags =
    -std=c++17
    -I test/mocks
    -I include
test_build_src = yes
lib_extra_dirs = test
lib_deps =
lib_ignore =
    RTClib
    NTPClient
    WiFi
    Wire
    Preferences
    Adafruit SSD1306
    Adafruit GFX Library
    Adafruit BusIO
build_src_filter =
    +<*>
    -<main.cpp>
    -<WebManager.cpp>
    -<TimeManager.cpp>
    -<DisplayManager.cpp>
    -<NotifyManager.cpp>
test_framework = unity

; ==============================================================================
; Coverage environment — generates gcov/lcov coverage report
; Run: pio test -e coverage && ./scripts/coverage.sh
; ==============================================================================
[env:coverage]
platform = native
build_flags =
    -std=c++17
    -I test/mocks
    -I include
    --coverage
    -O0
    -g
extra_scripts = pre:scripts/add_coverage_link.py
test_build_src = yes
lib_extra_dirs = test
lib_deps =
lib_ignore =
    RTClib
    NTPClient
    WiFi
    Wire
    Preferences
    Adafruit SSD1306
    Adafruit GFX Library
    Adafruit BusIO
build_src_filter =
    +<*>
    -<main.cpp>
    -<WebManager.cpp>
    -<TimeManager.cpp>
    -<DisplayManager.cpp>
    -<NotifyManager.cpp>
test_framework = unity
