[platformio]
default_envs = esp32dev

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; Serial monitor speed (must match Serial.begin(115200))
monitor_speed = 115200

; Libraries
lib_deps =
    adafruit/RTClib @ ^2.1.3
    arduino-libraries/NTPClient @ ^3.2.1
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    https://github.com/me-no-dev/AsyncTCP.git

; Build flags
build_flags =
    -D USE_WEBSERVER
    -D WIFI_SSID='"TIM ULTRAFIBRA_1C88_2G"'
    -D WIFI_PASSWORD='"MYjx!43GRw"'

; ==============================================================================
; Native test environment — runs on host machine (no ESP32 required)
; ==============================================================================
[env:native]
platform = native
build_flags =
    -std=c++17
    -I test/mocks
    -I include
test_build_src = yes
lib_extra_dirs = test
lib_deps =
lib_ignore =
    RTClib
    NTPClient
    WiFi
    Wire
    Preferences
build_src_filter =
    +<*>
    -<main.cpp>
    -<WebManager.cpp>
    -<RainMakerManager.cpp>
    -<TimeManager.cpp>
test_framework = unity

; ==============================================================================
; Coverage environment — generates gcov/lcov coverage report
; Run: pio test -e coverage && ./scripts/coverage.sh
; ==============================================================================
[env:coverage]
platform = native
build_flags =
    -std=c++17
    -I test/mocks
    -I include
    --coverage
    -O0
    -g
extra_scripts = pre:scripts/add_coverage_link.py
test_build_src = yes
lib_extra_dirs = test
lib_deps =
lib_ignore =
    RTClib
    NTPClient
    WiFi
    Wire
    Preferences
build_src_filter =
    +<*>
    -<main.cpp>
    -<WebManager.cpp>
    -<RainMakerManager.cpp>
    -<TimeManager.cpp>
test_framework = unity
